---
title: 负载均衡
category:
  - 高可用
order: 5
tag:
  - 服务高可用
  - 负载均衡
---

## 什么是负载均衡
负载均衡 指的是将用户请求分摊到不同的服务器上处理，以提高系统整体的并发处理能力以及可靠性。负载均衡服务可以有由专门的软件或者硬件来完成，一般情况下，硬件的性能更好，软件的价格更便宜（后文会详细介绍到）。
## 负载均衡分为哪几种
负载均衡可以简单分为 服务端负载均衡 和 客户端负载均衡 这两种。
服务端负载均衡涉及到的知识点更多，工作中遇到的也比较多，因为，我会花更多时间来介绍。
### 服务端负载均衡
通常在请求和网关层中间，加一个负载均衡（nginx）
硬件负载均衡（少见）
网络 二，三，四（tcp/udp），七层(http) 网络负载均衡.
**四层负载均衡性能很强，七层负载均衡功能更强**
### 客户端负载均衡
常见的有 spring cloud load balancer 和 Ribbon
## 常见的负载均衡算法
### 随机法
随机访问，可以加权重，优点简单粗暴，缺点毕竟随机，可以加了权重也可能一段时间访问不到
### 轮询法
多个服务轮流访问，可以加权重
### 平滑加权轮询算法
在轮询法基础上做了优化
比如三个服务，ABC，权重分别是 A3， B2， C1
正常的轮询算法请求到的服务顺序可能是 AAABBC
平滑加权轮询算法请求的服务顺序可能是 ABACBA，是请求更加分散。
### 两次随机轮询法
在随机法的基础上，多选出一个机器，在两个机器上再进行一次随机。
### 哈希法
将请求参数比如IP进行hash，再根据hash值决定使用那个服务器。能够尽量将相同的请求轮询到同一台服务器上
### 一致性Hash法
常规哈希法在服务器数量变化时，哈希值会重新落在不同的服务器上，这明显违背了使用哈希法的本意。而一致性哈希法的核心思想是将数据和节点都映射到一个哈希环上，然后根据哈希值的顺序来确定数据属于哪个节点。当服务器增加或删除时，只影响该服务器的哈希，而不会导致整个服务集群的哈希键值重新分布。
### 最小链接法
当有新的请求出现时，遍历服务器节点列表并选取其中连接数最小的一台服务器来响应当前请求。相同连接的情况下，可以进行加权随机。
最少连接数基于一个服务器连接数越多，负载就越高这一理想假设。然而， 实际情况是连接数并不能代表服务器的实际负载，有些连接耗费系统资源更多，有些连接不怎么耗费系统资源。
### 最少活跃法
最少活跃法和最小连接法类似，但要更科学一些。最少活跃法以活动连接数为标准，活动连接数可以理解为当前正在处理的请求数。活跃数越低，说明处理能力越强，这样就可以使处理能力强的服务器处理更多请求。相同活跃数的情况下，可以进行加权随机。
### 最快响应法
不同于最小连接法和最少活跃法，最快响应时间法以响应时间为标准来选择具体是哪一台服务器处理。客户端会维持每个服务器的响应时间，每次请求挑选响应时间最短的。相同响应时间的情况下，可以进行加权随机。
这种算法可以使得请求被更快处理，但可能会造成流量过于集中于高性能服务器的问题。
## 常见的七层负载均衡方案
DNS
Nginx反向代理




