---
title: 负载均衡
category:
  - 高可用
order: 1
tag:
  - 服务高可用
  - 负载均衡
---

## 负载均衡介绍
随着业务发展，单机服务早已不满足业务需求，而且也是为了安全考虑，我们的服务一般都是集群部署。  
负载均衡就是用于将请求分发到多个服务器（或者其他资源）上，以达到均衡负载、提高性能和可靠性的目的。  
负载均衡可以应用在各种系统中，包括网络服务、数据库集群、存储系统等。  


### 负载均衡分类
1. **硬件负载均衡器**：专用的硬件设备，通常具有高性能和高可靠性，适用于大型数据中心和企业级应用。
2. **软件负载均衡器**：运行在通用服务器或虚拟机上的软件程序，如 Nginx、HAProxy、F5 BIG-IP 等，具有灵活性和成本优势，适用于各种规模的应用。
3. **DNS 负载均衡器**：通过 DNS 解析来实现负载均衡，将域名解析到多个 IP 地址上，并按照一定策略进行分发。常用于分布式系统和全球负载均衡。
4. **服务端负载均衡**：由服务端自身实现负载均衡，如微服务架构中的服务注册中心和服务发现机制，通过动态路由和负载均衡算法来分发请求。
5. **客户端负载均衡**：例如，spring cloud load balancer 和 Ribbon


### 负载均衡分类主要功能和原理
1. **均衡负载**：负载均衡器将请求分发到多个服务器上，避免某一台服务器负载过重，提高整个系统的性能和吞吐量。
2. **高可用性**：负载均衡器可以监控服务器的健康状态，及时检测到故障或超负载的服务器，并将请求转发到其他可用的服务器上，保障系统的连续性和可用性。
3. **故障恢复**：当某个服务器发生故障时，负载均衡器可以自动将流量转移到其他健康的服务器上，实现故障的快速恢复。
4. **扩展性**：通过增加服务器实例，可以简单地扩展系统的处理能力，以应对增长的请求量和用户数量。

## 负载均衡算法
负载均衡器根据特定的算法来决定将请求分发到哪个服务器上。常见的负载均衡算法包括：

1. **轮询（Round Robin）**：依次将请求分发给每台服务器，循环进行。适用于服务器性能相近的情况。
2. **随机法**
3. **两次随机轮询法**: 在随机法的基础上，多选出一个机器，在两个机器上再进行一次随机。
4. **加权轮询（Weighted Round Robin）**：给每台服务器分配一个权重值，根据权重决定每次轮询时分配的请求量。
5. **平滑加权轮询算法**： 在轮询法基础上做了优化
> 比如三个服务，ABC，权重分别是 A3， B2， C1  
> 正常的轮询算法请求到的服务顺序可能是 AAABBC  
> 平滑加权轮询算法请求的服务顺序可能是 ABACBA  
> 请求更加分散。
6. **最小连接数（Least Connections）**：将请求分发到当前连接数最少的服务器上，以确保各服务器的连接数尽可能平衡。
7. **最少活跃法**: 以活动连接数为标准，活动连接数可以理解为当前正在处理的请求数。活跃数越低，说明处理能力越强，这样就可以使处理能力强的服务器处理更多请求。相同活跃数的情况下，可以进行加权随机。
8. **最少响应时间（Least Response Time）**：将请求分发到响应时间最短的服务器上，以提高用户体验。
9. **IP 哈希（IP Hash）**：根据请求的源 IP 地址计算哈希值，并将请求发送到对应的服务器上，以确保同一客户端的请求始终发送到同一台服务器上。
10. **一致性Hash法**: 一致性哈希法的核心思想是将数据和节点都映射到一个哈希环上，然后根据哈希值的顺序来确定数据属于哪个节点。当服务器增加或删除时，只影响该服务器的哈希，而不会导致整个服务集群的哈希键值重新分布。





