---
title: 数据加密
category:
  - 数据安全
order: 1
tag:
  - 数据安全
  - 数据加密
---

## 加密算法介绍
数据加密是保护数据隐私和安全的重要手段。常见的数据加密算法可以分为对称加密算法、非对称加密算法和哈希算法。

## 对称加密算法
对称加密算法使用相同的密钥进行加密和解密。其优点是速度快，适用于大规模数据的加密，但密钥管理较为复杂，因为密钥需要在发送方和接收方之间安全传输。

### AES（Advanced Encryption Standard）
AES是目前最广泛使用的对称加密算法，由美国国家标准与技术研究院（NIST）在2001年发布。  
密钥长度：128位、192位、256位。   
特点：安全性高，性能优异，被广泛应用于各种安全协议和应用中，如HTTPS、VPN、文件加密等。  

#### AES的结构
AES是一种迭代的对称加密算法，采用了分组密码设计。数据以128位（16字节）为一个分组进行处理。AES的主要操作单元是4×4的字节矩阵（状态矩阵）。

#### AES加密过程包括四个主要步骤：
1. 字节代换（SubBytes）：使用一个固定的S盒（Substitution box）对状态矩阵中的每个字节进行代换。
2. 行移位（ShiftRows）：将状态矩阵的每一行循环左移一定的字节数。
3. 列混淆（MixColumns）：对状态矩阵的每一列进行线性变换，混淆数据。
4. 轮密钥加（AddRoundKey）：将状态矩阵与轮密钥（Round Key）进行异或（XOR）运算。  


> 这些步骤在每一轮加密中重复执行，具体轮数取决于密钥长度：
> - 128位密钥：10轮
> - 192位密钥：12轮
> - 256位密钥：14轮

#### AES的加密流程
1. 密钥扩展：从原始密钥生成每一轮加密所需的轮密钥。
2. 初始轮（Initial Round）：
    - AddRoundKey：将状态矩阵与初始轮密钥进行异或运算。
3. 主轮（Main Rounds）：执行SubBytes、ShiftRows、MixColumns、AddRoundKey操作。
4. 最终轮（Final Round）：执行SubBytes、ShiftRows、AddRoundKey操作（不进行MixColumns）。

#### AES的解密流程
解密过程是加密过程的逆过程：
1. 密钥扩展：与加密相同，从原始密钥生成轮密钥。
2. 初始轮（Initial Round）：
    - AddRoundKey：将状态矩阵与初始轮密钥进行异或运算。
3. 主轮（Main Rounds）：执行InverseShiftRows、InverseSubBytes、AddRoundKey、InverseMixColumns操作。
4. 最终轮（Final Round）：执行InverseShiftRows、InverseSubBytes、AddRoundKey操作（不进行InverseMixColumns）。

### AES 加密模式
AES 可以通过多种模式（Modes of Operation）来加密数据。这些模式定义了如何处理超过单个块大小的数据，以及如何链接这些块。最常见的AES模式包括：
- ECB（Electronic Codebook）模式
- CBC（Cipher Block Chaining）模式
- CFB（Cipher Feedback）模式
- OFB（Output Feedback）模式
- CTR（Counter）模式

#### ECB（Electronic Codebook）模式
特点：每个明文块独立加密，产生相应的密文块。  
优点：实现简单，易于并行处理。  
缺点：相同的明文块总是会产生相同的密文块，容易受到模式分析攻击，不适合加密较大数据。  
用途：**一般不推荐使用ECB模式进行加密**，适用于加密少量的、没有模式重复的敏感数据。  

#### CBC（Cipher Block Chaining）模式
特点：每个明文块与前一个密文块进行异或后再加密，使用IV确保前几个块的随机性。  
优点：相同的明文块在不同位置上加密结果不同，增加了安全性。  
缺点：加密需要串行处理，不能并行处理。  
用途：广泛用于加密文件和数据传输，**推荐使用 CBC 模式**。  

#### CFB（Cipher Feedback）模式
特点：将前一个密文块的加密结果反馈到加密过程，用于加密下一个块。可以将数据分成小块处理。  
优点：可以加密不定长的数据流，适用于数据流加密。  
缺点：每个加密操作依赖前一个结果，不能并行处理。  
用途：适用于数据流和实时数据的加密。  

#### OFB（Output Feedback）模式  
特点：类似于CFB，但使用前一次加密的输出作为下次加密的输入，而不是使用密文块。可以将数据分成小块处理。  
优点：可以加密不定长的数据流，错误不会传播，适用于数据流加密。  
缺点：每个加密操作依赖前一个结果，不能并行处理。  
用途：适用于数据流和实时数据的加密。  

#### CTR（Counter）模式
特点：使用一个计数器生成每个块的独特值，与明文块进行异或操作。  
优点：可以并行处理，适用于多核处理器，提高加密速度。  
缺点：需要确保计数器的唯一性和不重复性。  
用途：广泛用于高性能加密应用，如磁盘加密和VPN。  


> **对于不需要网络传输加密key，且需要数据解密的加解密方式，推荐使用 AES。**     


### DES（Data Encryption Standard）  
简介：DES是由IBM设计并由美国政府于1977年采纳的对称加密算法。   
密钥长度：56位。  
特点：由于密钥长度较短，安全性已不再适应现代应用需求，逐渐被AES取代。  

### 3DES（Triple DES）  
简介：3DES是DES的改进版，通过对数据进行三次加密来提高安全性。  
密钥长度：112位或168位。  
特点：相较于DES安全性有所提升，但加密速度较慢，现已逐渐被AES取代。  

### Blowfish
简介：Blowfish由Bruce Schneier设计，是一种快速且安全的对称加密算法。  
密钥长度：32位到448位可变。  
特点：速度快，适合用于硬件和软件环境，但由于其设计较早，已被更新的算法（如AES）取代。  

### Twofish
简介：Twofish是Blowfish的继任者，由Bruce Schneier和其他人设计，进入了AES的最终评选阶段。  
密钥长度：128位、192位、256位。  
特点：安全性高，设计灵活，但未被广泛采用。  

## 非对称加密算法
非对称加密算法使用一对密钥进行加密和解密：公钥和私钥。公钥用于加密，私钥用于解密。其优点是密钥管理简单，因为公钥可以公开，但加密和解密速度较慢，适用于小规模数据加密或密钥交换。

### RSA
简介：RSA是1977年由Rivest、Shamir、Adleman设计的一种非对称加密算法。  
密钥长度：1024位、2048位、4096位。  
特点：安全性高，广泛应用于数字签名、密钥交换和加密协议（如SSL/TLS）。  

### DSA（Digital Signature Algorithm）  
简介：DSA是由美国国家标准与技术研究院（NIST）制定的用于数字签名的标准。  
密钥长度：1024位到3072位。  
特点：专用于数字签名，通常与其他加密算法（如RSA）一起使用。  

### ECC（Elliptic Curve Cryptography）
简介：ECC基于椭圆曲线数学，提供与RSA相当的安全性，但使用更短的密钥长度。  
密钥长度：160位到521位。  
特点：提供高安全性和高效性，适合资源受限的环境，如移动设备和物联网。  

## 哈希算法
哈希算法将任意长度的数据转换为固定长度的哈希值，通常用于数据完整性校验和密码存储。

### MD5（Message Digest Algorithm 5）
简介：MD5由Ronald Rivest设计，生成128位哈希值。  
特点：速度快，但已被发现存在严重的安全漏洞，不再推荐使用。  

### SHA-1（Secure Hash Algorithm 1）  
简介：SHA-1由美国国家安全局（NSA）设计，生成160位哈希值。
特点：安全性高于MD5，但也已被发现存在碰撞漏洞，不再推荐使用。

### SHA-2
简介：SHA-2是SHA-1的改进版，包含SHA-224、SHA-256、SHA-384、SHA-512等多个变种。  
特点：安全性高，广泛应用于各种安全协议和应用中，如SSL/TLS、区块链。  

### SHA-3
简介：SHA-3是最新的安全哈希算法标准，由NIST于2015年发布，基于Keccak算法。  
特点：安全性高，设计独特，与SHA-2不冲突，提供额外的安全性选择。  

## 总结
数据加密算法是保障数据安全的重要工具，选择合适的加密算法取决于具体的应用场景和安全需求。    
对称加密算法如AES适合大规模数据加密，非对称加密算法如RSA和ECC适合密钥交换和小规模数据加密，哈希算法如SHA-2适合数据完整性校验和密码存储。  
在实际应用中，通常会结合使用多种加密技术来实现全面的数据安全保护。  

## 实践
总结一下我们目前生产环境的一些加密方案：
1. 在电商公司，我们的一些关键 API 使用 RSA 对请求报文和响应报文进行了加密。
2. 做企业应用时由于很多数据需要比较敏感，我们很多数据库字段使用 AES 进行了加密，因为不牵扯加解密的密钥传输，所以没有使用 RSA，但是数据加密后又需要解密使用，无法使用哈希算法，为了防止数据被技术轻松解密，我们做了一个 KeyManager 系统，即使技术人员拿到了密钥也无法对数据进行解密，因为每次数据加密出来的数据都是不一样的，不同系统使用加密 KeysetHandle（基于google 的 tink实现） 也是不确定的。
3. 密码等数据是使用 SHA-2 进行加密的。  

以上是我们生产环境用到的一些加密方式，RSA，AES，MD5，SHA2 也是业内用的最多的加密方式。
