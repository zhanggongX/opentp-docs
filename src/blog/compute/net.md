---
title: 计算机网络
category:
  - 计算机基础
order: 2
tag:
  - 计算机基础
  - 网络
---

## 网络模型
主要的网络模型包括：  
OSI（Open Systems Interconnection）七层模型  
TCP/IP（Transmission Control Protocol/Internet Protocol）四层模型。  

### OSI 模型
OSI 模型由国际标准化组织（ISO）提出，是一个七层网络模型，用于定义和规范网络通信的过程。每一层都有特定的功能，通过封装与解封装的方式向上或向下传递数据。

### OSI 模型图示

```
+----------------------+
| 应用层   (Application) |
+----------------------+
| 表示层   (Presentation)|
+----------------------+
| 会话层   (Session)    |
+----------------------+
| 传输层   (Transport)  |
+----------------------+
| 网络层   (Network)    |
+----------------------+
| 数据链路层 (Data Link) |
+----------------------+
| 物理层   (Physical)   |
+----------------------+
```

### OSI 模型的七层结构

1. 物理层（Physical Layer）  
定义了物理设备的标准，包括接口、电压、传输速度、信号调制等。主要负责数据的物理传输，如电信号或光信号。   
比如设备：网线、光纤、网卡等。   
主要协议有：以太网、RS-232 等。  

2. 数据链路层（Data Link Layer）    
提供介质访问控制（MAC）和链路管理，确保可靠的数据传输。处理数据帧的封装与传输，负责错误检测和纠正。  
比如设备：交换机、网桥。  
主要协议有：以太网协议、帧中继（Frame Relay）、PPP（点对点协议）。

3. 网络层（Network Layer）  
负责数据的路由和转发，提供逻辑地址的分配和管理，实现不同网络之间的数据通信。  
比如设备：路由器。   
主要协议有：IP、ICMP、ARP。

4. 传输层（Transport Layer）  
提供端到端的通信服务，负责数据的分段、重组、流量控制和错误处理。  
协议：TCP（Transmission Control Protocol）、UDP（User Datagram Protocol）。

5. 会话层（Session Layer）   
管理会话连接，负责建立、维护和终止通信会话，支持数据的同步和恢复。  
协议：PPTP（Point-to-Point Tunneling Protocol）、RPC（Remote Procedure Call）。

6. 表示层（Presentation Layer）  
处理数据的格式化、加密、解密和压缩，确保数据能够被接收方正确解释。
协议：SSL/TLS、JPEG、GIF、MPEG。

7. 应用层（Application Layer）
提供网络服务和接口给应用程序，包括文件传输、电子邮件、远程登录等。
协议：HTTP、FTP、SMTP、DNS。



### TCP/IP 模型

TCP/IP 模型是由美国国防部开发的四层模型，是现代互联网的基础。相比 OSI 模型，TCP/IP 模型更为简洁实用，强调实现而非理论。

### TCP/IP 模型图示

```
+---------------------+
| 应用层 (Application) |
+---------------------+
| 传输层 (Transport)  |
+---------------------+
| 网络层 (Internet)   |
+---------------------+
| 网络接口层 (Network Interface) |
+---------------------+
```

### TCP/IP 模型的四层结构

1. 网络接口层（Network Interface Layer）  
对应 OSI 的物理层和数据链路层，负责在特定物理网络上发送 IP 数据包。  
协议：以太网协议、Wi-Fi、Token Ring。

2. 网络层（Internet Layer）  
与 OSI 的网络层相似，负责路由和转发数据包。
协议：IP（Internet Protocol）、ICMP、ARP。

3. 传输层（Transport Layer）  
提供端到端的通信服务，类似于 OSI 模型的传输层。  
协议：TCP、UDP。  

4. 应用层（Application Layer）  
对应 OSI 模型的会话层、表示层和应用层，直接为应用程序提供服务。  
协议：HTTP、FTP、SMTP、DNS。

## OSI 与 TCP/IP 模型对比

- 层数：OSI 模型有七层，TCP/IP 模型有四层。
- 应用：OSI 是理论模型，主要用于教学和标准化；TCP/IP 是实际应用的网络模型。
- 灵活性：OSI 模型较为复杂，适合各种通信系统的描述；TCP/IP 模型较为灵活，简化了实现过程。

### 图示对比

```
OSI 模型                          TCP/IP 模型
+------------------+               +-----------------+
| 应用层 (Application)   | <-> | 应用层 (Application)|
+------------------+               +-----------------+
| 表示层 (Presentation) | <-> |                   |
+------------------+               +-----------------+
| 会话层 (Session)      | <-> |                   |
+------------------+               +-----------------+
| 传输层 (Transport)   | <-> | 传输层 (Transport) |
+------------------+               +-----------------+
| 网络层 (Network)     | <-> | 网络层 (Internet)  |
+------------------+               +-----------------+
| 数据链路层 (Data Link) | <-> | 网络接口层 (Network Interface)|
+------------------+               +-----------------+
| 物理层 (Physical)     | <-> |                   |
+------------------+               +-----------------+
```

## 通信过程

### 从 HTTP 到 MAC

1. HTTP 层（应用层）  
应用程序生成一个 HTTP 请求，例如浏览器访问一个网页。请求头部和数据被封装成 HTTP 报文。

   ```http
   GET /index.html HTTP/1.1
   Host: www.example.com
   ```

2. TCP 层（传输层）  
首先 HTTP 报文被封装成 TCP 数据段（Segment），如果数据过大，TCP 会将其分段， 然后给 HTTP 报文添加头部， TCP 头部包含源端口、目标端口、序列号等信息，最后通过三次握手建立与服务器的连接。

   ```text
   +--------------------------------------+
   | TCP 头部 | HTTP 数据                 |
   +--------------------------------------+
   ```

3. IP 层（网络层）    
首先，TCP 数据段被封装成 IP 数据包（Packet），然后添加 IP 头部，包含源 IP 地址、目标 IP 地址等信息。数据包通过路由器进行转发，选择最佳路径到达目标网络。  

   ```text
   +---------------------------------------------+
   | IP 头部 | TCP 数据段                        |
   +---------------------------------------------+
   ```

4. 网络接口层（MAC 层）  
首先，IP 数据包被封装成帧（Frame），帧的头部包含源 MAC 地址、目标 MAC 地址，尾部包含校验码。帧通过网络介质（如以太网、Wi-Fi）发送到物理网络。

   ```text
   +----------------------------------------------------+
   | MAC 头部 | IP 数据包                         | FCS |
   +----------------------------------------------------+
   ```



### 从 MAC 到 HTTP
从 MAC 到 HTTP 是从 HTTP 到 MAC 过程的逆过程。

### 总结
网络通信过程，从高层协议到底层协议，就是一直封包的过程，一直添加底层协议的数据包头。  
以 TCP 通信为例，假设我们有两个设备，
在 TCP 通信过程中，特别是在不同子网之间的通信，数据包会经过多次封装和解封装，涉及 IP 地址和 MAC 地址的不断变化。下面是详细的过程和变化情况：

## TCP 通信过程概述

- TCP 三次握手：建立连接。
- 数据传输：交换数据。
- TCP 四次挥手：断开连接。

我们重点关注数据包在不同子网之间传输的过程，详细讲解 IP 和 MAC 地址如何变化。

## 不同子网之间的通信

### 场景设置

假设有两个子网：

- 子网 1：192.168.1.0/24
  - 主机 A：192.168.1.2，MAC 地址：AA:AA:AA:AA:AA:AA
  - 路由器 R1：192.168.1.1，MAC 地址：R1:MAC:1
- 子网 2：192.168.2.0/24
  - 主机 B：192.168.2.2，MAC 地址：BB:BB:BB:BB:BB:BB
  - 路由器 R2：192.168.2.1，MAC 地址：R2:MAC:1

路由器 R1 和 R2 通过一个中间网络连接，如下图：

```
  子网 1                    中间网络                    子网 2
  [主机 A] <--> [R1] <-----> [R2] <--> [主机 B]
```

### 数据包传输过程

1. 主机 A 向主机 B 发送数据

   - 主机 A 生成 TCP 数据：包括源 IP：192.168.1.2，目标 IP：192.168.2.2。
   - 主机 A 查询路由：发现目标 IP 不在同一子网，需要通过网关 R1 转发。

2. 主机 A 封装数据包

   - 生成 TCP 数据段：包括源端口、目标端口、序列号等。
   - 生成 IP 数据包：包括源 IP 地址（192.168.1.2），目标 IP 地址（192.168.2.2）。
   - 生成帧：主机 A 使用 ARP（地址解析协议）查询 R1 的 MAC 地址，将目标 MAC 地址设为 R1:MAC:1。

   ```text
   +---------------------------+-------------------------------+-------------------------------+
   | MAC 头部 (AA:AA:AA:AA:AA:AA -> R1:MAC:1)                   | 数据内容                       |
   +---------------------------+-------------------------------+-------------------------------+
   | IP 头部 (192.168.1.2 -> 192.168.2.2)                       | TCP 数据段                     |
   +---------------------------+-------------------------------+-------------------------------+
   ```

3. 主机 A 发送数据到路由器 R1

   - 帧到达 R1：R1 接收到帧，根据 MAC 地址识别为自己的帧。
   - R1 解封装帧：去掉 MAC 头部，获得 IP 数据包。

4. 路由器 R1 转发数据包

   - R1 查询路由表：发现目标 IP 在 192.168.2.0/24 子网，需要通过 R2 转发。
   - R1 封装新的帧：将目标 MAC 地址设为 R2 的 MAC 地址（R2:MAC:1）。

   ```text
   +---------------------------+-------------------------------+-------------------------------+
   | MAC 头部 (R1:MAC:1 -> R2:MAC:1)                            | 数据内容                       |
   +---------------------------+-------------------------------+-------------------------------+
   | IP 头部 (192.168.1.2 -> 192.168.2.2)                       | TCP 数据段                     |
   +---------------------------+-------------------------------+-------------------------------+
   ```

5. 数据包在中间网络中传输

   - R1 发送到 R2：帧从 R1 到达 R2。
   - R2 接收并解封装帧：R2 解封装帧，检查 IP 数据包。

6. 路由器 R2 转发数据包

   - R2 查询路由表：发现目标 IP 地址属于 192.168.2.0/24 子网，下一跳为主机 B。
   - R2 封装新的帧：将目标 MAC 地址设为主机 B 的 MAC 地址（BB:BB:BB:BB:BB:BB）。

   ```text
   +---------------------------+-------------------------------+-------------------------------+
   | MAC 头部 (R2:MAC:1 -> BB:BB:BB:BB:BB:BB)                   | 数据内容                       |
   +---------------------------+-------------------------------+-------------------------------+
   | IP 头部 (192.168.1.2 -> 192.168.2.2)                       | TCP 数据段                     |
   +---------------------------+-------------------------------+-------------------------------+
   ```

7. 主机 B 接收数据

   - 帧到达主机 B：主机 B 接收到帧，根据 MAC 地址识别为自己的帧。
   - 主机 B 解封装帧：去掉 MAC 头部，检查 IP 数据包。
   - 解封装 IP 数据包：去掉 IP 头部，检查 TCP 数据段。
   - TCP 处理：主机 B 根据 TCP 头部信息处理数据，发送确认消息。

### 数据包的 IP 和 MAC 地址变化

| 阶段            | 源 IP 地址      | 目标 IP 地址     | 源 MAC 地址        | 目标 MAC 地址       |
| --------------- | --------------- | --------------- | ------------------ | ------------------- |
| 主机 A 发送     | 192.168.1.2     | 192.168.2.2     | AA:AA:AA:AA:AA:AA  | R1:MAC:1            |
| R1 转发到 R2    | 192.168.1.2     | 192.168.2.2     | R1:MAC:1           | R2:MAC:1            |
| R2 转发到主机 B | 192.168.1.2     | 192.168.2.2     | R2:MAC:1           | BB:BB:BB:BB:BB:BB   |
| 主机 B 接收     | 192.168.1.2     | 192.168.2.2     | BB:BB:BB:BB:BB:BB  | B 无需更改         |

### 详细图示

```
主机 A (192.168.1.2)
  源 MAC: AA:AA:AA:AA:AA:AA
  源 IP: 192.168.1.2
  目标 IP: 192.168.2.2

   | (MAC: AA:AA:AA:AA:AA:AA -> R1:MAC:1)
   V

路由器 R1
  源 MAC: R1:MAC:1
  源 IP: 192.168.1.2
  目标 IP: 192.168.2.2

   | (MAC: R1:MAC:1 -> R2:MAC:1)
   V

路由器 R2
  源 MAC: R2:MAC:1
  源 IP: 192.168.1.2
  目标 IP: 192.168.2.2

   | (MAC: R2:MAC:1 -> BB:BB:BB:BB:BB:BB)
   V

主机 B (192.168.2.2)
  源 MAC: BB:BB:BB:BB:BB:BB
  源 IP: 192.168.1.2
  目标 IP: 192.168.2.2
```

### 总结

- MAC 地址变化：每一跳（如主机到路由器，路由器到路由器，路由器到主机），MAC 地址会变化为下一跳的目标 MAC 地址。
- IP 地址不变：源 IP 和目标 IP 在整个传输过程中保持不变，用于标识端到端的通信。
- 路由转发：路由器根据目标 IP 地址选择下一跳，将数据包封装为新的帧并发送。
- ARP 协议：用于解析 IP 地址到 MAC 地址，以便数据链路层传输。

这种详细理解可以帮助我们分析网络通信过程中的问题，如数据丢失、网络延迟等，并提高网络性能和可靠性。如果有更多问题，欢迎继续探讨。

## TCP&UDP

## IP

## ARP&RARP

## Http

## WebSocket

## 打开一个网页

## PING

## DNS

## 网络安全