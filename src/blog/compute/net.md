---
title: 计算机网络
category:
  - 计算机基础
order: 2
tag:
  - 计算机基础
  - 网络
---

## 网络模型
主要的网络模型包括：  
OSI（Open Systems Interconnection）七层模型  
TCP/IP（Transmission Control Protocol/Internet Protocol）四层模型。  

### OSI 模型
OSI 模型由国际标准化组织（ISO）提出，是一个七层网络模型，用于定义和规范网络通信的过程。每一层都有特定的功能，通过封装与解封装的方式向上或向下传递数据。

### OSI 模型图示

```
+----------------------+
| 应用层   (Application) |
+----------------------+
| 表示层   (Presentation)|
+----------------------+
| 会话层   (Session)    |
+----------------------+
| 传输层   (Transport)  |
+----------------------+
| 网络层   (Network)    |
+----------------------+
| 数据链路层 (Data Link) |
+----------------------+
| 物理层   (Physical)   |
+----------------------+
```

### OSI 模型的七层结构

1. 物理层（Physical Layer）  
定义了物理设备的标准，包括接口、电压、传输速度、信号调制等。主要负责数据的物理传输，如电信号或光信号。   
比如设备：网线、光纤、网卡等。   
主要协议有：以太网、RS-232 等。  

2. 数据链路层（Data Link Layer）    
提供介质访问控制（MAC）和链路管理，确保可靠的数据传输。处理数据帧的封装与传输，负责错误检测和纠正。  
比如设备：交换机、网桥。  
主要协议有：以太网协议、帧中继（Frame Relay）、PPP（点对点协议）。

3. 网络层（Network Layer）  
负责数据的路由和转发，提供逻辑地址的分配和管理，实现不同网络之间的数据通信。  
比如设备：路由器。   
主要协议有：IP、ICMP、ARP。

4. 传输层（Transport Layer）  
提供端到端的通信服务，负责数据的分段、重组、流量控制和错误处理。  
协议：TCP（Transmission Control Protocol）、UDP（User Datagram Protocol）。

5. 会话层（Session Layer）   
管理会话连接，负责建立、维护和终止通信会话，支持数据的同步和恢复。  
协议：PPTP（Point-to-Point Tunneling Protocol）、RPC（Remote Procedure Call）。

6. 表示层（Presentation Layer）  
处理数据的格式化、加密、解密和压缩，确保数据能够被接收方正确解释。
协议：SSL/TLS、JPEG、GIF、MPEG。

7. 应用层（Application Layer）
提供网络服务和接口给应用程序，包括文件传输、电子邮件、远程登录等。
协议：HTTP、FTP、SMTP、DNS。



### TCP/IP 模型

TCP/IP 模型是由美国国防部开发的四层模型，是现代互联网的基础。相比 OSI 模型，TCP/IP 模型更为简洁实用，强调实现而非理论。

### TCP/IP 模型图示

```
+---------------------+
| 应用层 (Application) |
+---------------------+
| 传输层 (Transport)  |
+---------------------+
| 网络层 (Internet)   |
+---------------------+
| 网络接口层 (Network Interface) |
+---------------------+
```

### TCP/IP 模型的四层结构

1. 网络接口层（Network Interface Layer）  
对应 OSI 的物理层和数据链路层，负责在特定物理网络上发送 IP 数据包。  
协议：以太网协议、Wi-Fi、Token Ring。

2. 网络层（Internet Layer）  
与 OSI 的网络层相似，负责路由和转发数据包。
协议：IP（Internet Protocol）、ICMP、ARP。

3. 传输层（Transport Layer）  
提供端到端的通信服务，类似于 OSI 模型的传输层。  
协议：TCP、UDP。  

4. 应用层（Application Layer）  
对应 OSI 模型的会话层、表示层和应用层，直接为应用程序提供服务。  
协议：HTTP、FTP、SMTP、DNS。

## OSI 与 TCP/IP 模型对比

- 层数：OSI 模型有七层，TCP/IP 模型有四层。
- 应用：OSI 是理论模型，主要用于教学和标准化；TCP/IP 是实际应用的网络模型。
- 灵活性：OSI 模型较为复杂，适合各种通信系统的描述；TCP/IP 模型较为灵活，简化了实现过程。

### 图示对比

```
OSI 模型                          TCP/IP 模型
+------------------+               +-----------------+
| 应用层 (Application)   | <-> | 应用层 (Application)|
+------------------+               +-----------------+
| 表示层 (Presentation) | <-> |                   |
+------------------+               +-----------------+
| 会话层 (Session)      | <-> |                   |
+------------------+               +-----------------+
| 传输层 (Transport)   | <-> | 传输层 (Transport) |
+------------------+               +-----------------+
| 网络层 (Network)     | <-> | 网络层 (Internet)  |
+------------------+               +-----------------+
| 数据链路层 (Data Link) | <-> | 网络接口层 (Network Interface)|
+------------------+               +-----------------+
| 物理层 (Physical)     | <-> |                   |
+------------------+               +-----------------+
```

## 通信过程

### 从 HTTP 到 MAC

1. HTTP 层（应用层）  
应用程序生成一个 HTTP 请求，例如浏览器访问一个网页。请求头部和数据被封装成 HTTP 报文。

   ```http
   GET /index.html HTTP/1.1
   Host: www.example.com
   ```

2. TCP 层（传输层）  
首先 HTTP 报文被封装成 TCP 数据段（Segment），如果数据过大，TCP 会将其分段， 然后给 HTTP 报文添加头部， TCP 头部包含源端口、目标端口、序列号等信息，最后通过三次握手建立与服务器的连接。

   ```text
   +--------------------------------------+
   | TCP 头部 | HTTP 数据                 |
   +--------------------------------------+
   ```

3. IP 层（网络层）    
首先，TCP 数据段被封装成 IP 数据包（Packet），然后添加 IP 头部，包含源 IP 地址、目标 IP 地址等信息。数据包通过路由器进行转发，选择最佳路径到达目标网络。  

   ```text
   +---------------------------------------------+
   | IP 头部 | TCP 数据段                        |
   +---------------------------------------------+
   ```

4. 网络接口层（MAC 层）  
首先，IP 数据包被封装成帧（Frame），帧的头部包含源 MAC 地址、目标 MAC 地址，尾部包含校验码。帧通过网络介质（如以太网、Wi-Fi）发送到物理网络。

   ```text
   +----------------------------------------------------+
   | MAC 头部 | IP 数据包                         | FCS |
   +----------------------------------------------------+
   ```



### 从 MAC 到 HTTP
从 MAC 到 HTTP 是从 HTTP 到 MAC 过程的逆过程。

### 总结
网络通信过程，从高层协议到底层协议，就是一直封包的过程，一直添加底层协议的数据包头。  
以 TCP 通信为例，假设我们有两个设备，
- A， ip：192.168.0.1， MAC：AA-AA-AA-AA-AA 
- B， ip：192.168.2.2， MAC：BB-BB-BB-BB-BB

1. 首先 A（192.168.0.1）通过子网掩码（255.255.255.0）计算出自己与 B（192.168.2.2）并不在同一个子网内，于是需要发送给默认网关（192.168.0.254）
2. A 通过 ARP 协议找到默认网关 192.168.0.254 的 MAC 地址。
3. A 将源 MAC 地址（AA-AA-AA-AA-AA）与网关 MAC 地址（XXXXXX）封装在数据链路层头部，又将源 IP 地址（192.168.0.1）和目的 IP 地址（192.168.2.2）封装在网络层头部，然后发包出去
> 注意这里千万不要以为填写的是默认网关的 IP 地址，从始至终这个数据包的两个 IP 地址都是不变的，只有 MAC 地址在不断变化。
4. 192.168.0.1 的交换机收到数据包后，发现目标 MAC 地址是 XXXXX，转发给网络链路上某个路由器。
5. 数据包来到了路由器，发现其目标 IP 地址是 192.168.2.2，查看其路由表，发现了下一跳的地址。
6. 所以此时路由器需要做两件事，第一件是再次匹配路由表，找到匹配的端口，将其封装到数据链路层，最后把包从该口发出去。  
7. 但此时链路上另一个路由器，查看其 arp 缓存，查到了 192.168.2.2 的 MAC 地址为 BB-BB-BB-BB-BB，将其封装在数据链路层头部，并从某个端口发出去。
9. 交换机 3 收到了数据包，发现目的 MAC 地址为 BB-BB-BB-BB-BB，查询其 MAC 地址表，发现应该从其 6 号端口出去，于是从 6 号端口把数据包发出去。
10.B 最终收到了数据包！并且发现目的 MAC 地址就是自己，于是收下了这个包

## TCP&UDP

## IP

## ARP&RARP

## Http

## WebSocket

## 打开一个网页

## PING

## DNS

## 网络安全